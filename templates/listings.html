{% extends "base.html" %}
{% block content %}
<h2>All listings</h2>

<form method="get" action="{{ url_for('listings_page') }}">
  <p>
    <label>Keyword</label><br>
    <input type="text" name="q" value="{{ q }}" maxlength="80">
  </p>
  <p>
    <label>Category</label><br>
    <select name="category_id">
      <option value="">All</option>
      {% for c in cats %}
        <option value="{{ c['id'] }}" {% if category_id and c['id'] == category_id|int %}selected{% endif %}>
          {{ c['name'] }}
        </option>
      {% endfor %}
    </select>
  </p>
  <p><button type="submit">Search</button></p>
</form>

{% if rows %}
<ul>
  {% for row in rows %}
  <li>
    <h3><a href="{{ url_for('listing_detail', listing_id=row['id']) }}">{{ row['title'] }}</a></h3>
    <div>{{ row['location'] }} · €{{ row['price_eur'] }} · by {{ row['username'] }} · {{ row['created_at'] }}</div>
    <p>{{ row['description'][:180] }}{% if row['description']|length > 180 %}...{% endif %}</p>
  </li>
  {% endfor %}
</ul>
{% else %}
<p>No listings.</p>
{% endif %}
{% endblock %}